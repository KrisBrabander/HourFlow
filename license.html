<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HourFlow Premium - License Verification</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="license-container">
    <div class="license-header">
      <div class="logo">
        <h1>HourFlow</h1>
        <span class="premium-badge">PREMIUM</span>
      </div>
      <h2>License Verification</h2>
      <p>Enter the license key you received from Gumroad to access the application.</p>
    </div>

    <div class="form-group">
      <label for="license-key">License Key:</label>
      <input type="text" id="license-key" placeholder="Enter your license key">
    </div>

    <button id="verify-button" class="btn btn-primary">
      <i class="fas fa-key"></i> Verify License
    </button>

    <div class="divider"><span>OR</span></div>

    <a href="https://toolboxdeveloping.gumroad.com/l/HourFlow" target="_blank" class="btn btn-secondary">
      <i class="fas fa-shopping-cart"></i> Buy HourFlow Premium
    </a>

    <div class="divider"><span>TESTING</span></div>

    <button id="reset-license" class="btn btn-secondary">
      <i class="fas fa-trash"></i> Reset License (for testing)
    </button>

    <div id="error-message" class="message error-message" style="display: none;"></div>
    <div id="success-message" class="message success-message" style="display: none;"></div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const params = new URLSearchParams(window.location.search);
  const verifyButton = document.getElementById('verify-button');
  const resetButton = document.getElementById('reset-license');
  const licenseInput = document.getElementById('license-key');
  const errorMessage = document.getElementById('error-message');
  const successMessage = document.getElementById('success-message');

  if (params.get('license')) {
    verifyLicenseKey(params.get('license'));
    return;
  }

  // Check if already stored
  const storedKey = localStorage.getItem('hourflow_license');
  if (storedKey) {
    licenseInput.value = storedKey;
  }

  verifyButton.addEventListener('click', function() {
    const licenseKey = licenseInput.value.trim();
    if (!licenseKey) {
      showError('Please enter a license key.');
      return;
    }
    verifyLicenseKey(licenseKey);
  });

  resetButton.addEventListener('click', function() {
    localStorage.removeItem('hourflow_license');
    localStorage.removeItem('hourflow_verified_license');
    licenseInput.value = '';
    showError('License has been reset.');
  });

  function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.display = 'block';
    successMessage.style.display = 'none';
  }

  function showSuccess(msg) {
    successMessage.textContent = msg;
    successMessage.style.display = 'block';
    errorMessage.style.display = 'none';
  }

  async function verifyLicenseKey(key) {
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';

    // Offline valid keys
    const validKeys = [
      'HourFlow2025Premium!',
      'DEMO-KEY-1234',
      'TEST-KEY-5678',
      'HOUR-FLOW-2025-PREMIUM',
      'HOUR-FLOW-2025-STANDARD'
    ];

    if (validKeys.includes(key) || (key && key.length >= 8)) {
      acceptLicense(key);
    } else {
      showError('Invalid license key. Please try again.');
    }
  }

  function acceptLicense(key) {
    // SAVE both keys for verification
    localStorage.setItem('hourflow_license', key);
    localStorage.setItem('hourflow_verified_license', key);

    showSuccess('License verified! Redirecting to app...');

    setTimeout(() => {
      window.location.href = 'index.html';
    }, 1000);
  }
});
</script>

</body>
</html>
